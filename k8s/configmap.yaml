---
# ==========================================
# ConfigMap - Global Environment Variables
# ==========================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: sf1-config
  namespace: sf1-ultimate
  labels:
    app: sf1-ultimate
data:
  # Node Environment
  NODE_ENV: "production"

  # Logging
  LOG_LEVEL: "info"

  # API Configuration
  API_VERSION: "v1"

  # CORS Origins (comma-separated)
  CORS_ORIGINS: "https://sf1.example.com,https://api.sf1.example.com"

  # Rate Limiting
  RATE_LIMIT_WINDOW_MS: "900000"  # 15 minutes
  RATE_LIMIT_MAX_REQUESTS: "100"

  # JWT Configuration
  JWT_ACCESS_EXPIRY: "15m"
  JWT_REFRESH_EXPIRY: "7d"

  # Monitoring
  ENABLE_METRICS: "true"
  METRICS_PORT: "9090"

---
# ==========================================
# ConfigMap - Auth Service
# ==========================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: auth-service-config
  namespace: sf1-ultimate
  labels:
    app: auth-service
data:
  SERVICE_NAME: "auth-service"
  PORT: "3001"

  # Database
  DATABASE_PROVIDER: "postgresql"
  DATABASE_HOST: "postgres-service"
  DATABASE_PORT: "5432"
  DATABASE_NAME: "sf1_auth"

  # Redis
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"

---
# ==========================================
# ConfigMap - Price Service
# ==========================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: price-service-config
  namespace: sf1-ultimate
  labels:
    app: price-service
data:
  SERVICE_NAME: "price-service"
  PORT: "3002"

  # MongoDB
  MONGODB_HOST: "mongodb-service"
  MONGODB_PORT: "27017"
  MONGODB_DATABASE: "sf1_prices"

  # Redis
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"

  # Scraper Configuration
  SCRAPER_INTERVAL_MS: "60000"  # 1 minute
  SCRAPER_TIMEOUT_MS: "30000"   # 30 seconds

---
# ==========================================
# ConfigMap - Frontend
# ==========================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-config
  namespace: sf1-ultimate
  labels:
    app: frontend
data:
  SERVICE_NAME: "frontend"
  PORT: "3000"

  # API URLs
  NEXT_PUBLIC_API_URL: "https://api.sf1.example.com"
  NEXT_PUBLIC_WS_URL: "wss://ws.sf1.example.com"

  # Feature Flags
  NEXT_PUBLIC_ENABLE_ANALYTICS: "true"
  NEXT_PUBLIC_ENABLE_PWA: "true"

---
# ==========================================
# ConfigMap - Nginx
# ==========================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: sf1-ultimate
  labels:
    app: nginx
data:
  nginx.conf: |
    worker_processes auto;
    error_log /var/log/nginx/error.log warn;
    pid /var/run/nginx.pid;

    events {
        worker_connections 4096;
        use epoll;
        multi_accept on;
    }

    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        log_format json escape=json '{'
            '"time": "$time_iso8601",'
            '"remote_addr": "$remote_addr",'
            '"request_method": "$request_method",'
            '"request_uri": "$request_uri",'
            '"status": $status,'
            '"body_bytes_sent": $body_bytes_sent,'
            '"request_time": $request_time,'
            '"upstream_response_time": "$upstream_response_time"'
        '}';

        access_log /var/log/nginx/access.log json;

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        server_tokens off;

        gzip on;
        gzip_vary on;
        gzip_proxied any;
        gzip_comp_level 6;
        gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss;

        include /etc/nginx/conf.d/*.conf;
    }
